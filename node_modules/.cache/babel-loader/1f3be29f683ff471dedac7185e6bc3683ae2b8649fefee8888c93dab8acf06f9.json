{"ast":null,"code":"import { createAsyncThunk, createSlice, current } from '@reduxjs/toolkit';\nimport AuthService from '../service/authService';\nimport { finishLoading, startLoading } from './Loading';\nconst authService = AuthService.getHttpInstance();\nexport const authRegister = createAsyncThunk('auth/REGISTER', async (form, thunkAPI) => {\n  console.log('async');\n  console.log(thunkAPI);\n  try {\n    return await authService.signup(form.username, form.password);\n  } catch (e) {\n    console.log(e, 'error');\n    return thunkAPI.rejectWithValue({\n      error: e\n    });\n  }\n});\nexport const authLogin = createAsyncThunk('auth/LOGIN', async (form, thunkAPI) => {\n  thunkAPI.dispatch(startLoading());\n  try {\n    return {\n      payload: {\n        token: '123',\n        username: '123'\n      }\n    };\n  } catch (e) {\n    return thunkAPI.rejectWithValue({\n      error: '123'\n    });\n  } finally {\n    thunkAPI.dispatch(finishLoading());\n  }\n});\nconst initialAuthFormState = {\n  register: {\n    username: '',\n    password: '',\n    passwordConfirm: ''\n  },\n  login: {\n    username: '',\n    password: ''\n  },\n  authError: null,\n  authDuplicateError: null,\n  auth: null\n};\nconst authSlice = createSlice({\n  name: 'authForm',\n  initialState: initialAuthFormState,\n  reducers: {\n    changeField: (state, _ref) => {\n      let {\n        payload\n      } = _ref;\n      const {\n        form,\n        name,\n        value\n      } = payload;\n      console.log(current(state));\n      state[form][name] = value;\n    },\n    initialForm: (state, _ref2) => {\n      let {\n        payload\n      } = _ref2;\n      const {\n        form\n      } = payload;\n      if (form === 'login') state[form] = initialAuthFormState[form];else state[form] = initialAuthFormState[form];\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(authRegister.pending, (state, action) => {\n      console.log('pending auth');\n    }).addCase(authRegister.fulfilled, (state, action) => {\n      console.log('fulfilled auth');\n    }).addCase(authRegister.rejected, (state, action) => {\n      console.log('rejected auth');\n      console.log(action);\n    }).addCase(authLogin.pending, (state, action) => {\n      console.log('pending');\n    }).addCase(authLogin.fulfilled, (state, action) => {\n      console.log('fulfilled');\n    }).addCase(authLogin.rejected, (state, action) => {\n      console.log('rejected');\n    });\n  }\n});\nexport const {\n  changeField,\n  initialForm\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","current","AuthService","finishLoading","startLoading","authService","getHttpInstance","authRegister","form","thunkAPI","console","log","signup","username","password","e","rejectWithValue","error","authLogin","dispatch","payload","token","initialAuthFormState","register","passwordConfirm","login","authError","authDuplicateError","auth","authSlice","name","initialState","reducers","changeField","state","value","initialForm","extraReducers","builder","addCase","pending","action","fulfilled","rejected","actions","reducer"],"sources":["/Users/ysy/projects/ticktickup-client/src/modules/auth.ts"],"sourcesContent":["import {\n  createAsyncThunk,\n  createSlice,\n  current,\n  PayloadAction,\n} from '@reduxjs/toolkit';\nimport { AppDispatch } from '.';\nimport AuthService from '../service/authService';\nimport { finishLoading, startLoading } from './Loading';\n\nconst authService = AuthService.getHttpInstance();\n\nexport interface AuthSuccessResponse {\n  username: string;\n  token: string;\n}\n\nexport interface AuthFailResponse {\n  error: string;\n}\n\nexport type Register = {\n  username: string;\n  password: string;\n  passwordConfirm: string;\n  [key: string]: string;\n};\n\nexport type Login = {\n  username: string;\n  password: string;\n  [key: string]: string;\n};\n\nexport const authRegister = createAsyncThunk(\n  'auth/REGISTER',\n  async (form: { username: string; password: string }, thunkAPI) => {\n    console.log('async');\n    console.log(thunkAPI);\n\n    try {\n      return await authService.signup(form.username, form.password);\n    } catch (e) {\n      console.log(e, 'error');\n      return thunkAPI.rejectWithValue({ error: e });\n    }\n  }\n);\n\nexport const authLogin = createAsyncThunk(\n  'auth/LOGIN',\n  async (form: Login, thunkAPI) => {\n    thunkAPI.dispatch(startLoading());\n    try {\n      return { payload: { token: '123', username: '123' } };\n    } catch (e) {\n      return thunkAPI.rejectWithValue({ error: '123' });\n    } finally {\n      thunkAPI.dispatch(finishLoading());\n    }\n  }\n);\n\ninterface InitialAuthFormState {\n  register: Register;\n  login: Login;\n  authError: string | null;\n  authDuplicateError: string | null;\n  auth: null | { [key: string]: string };\n}\n\nconst initialAuthFormState: InitialAuthFormState = {\n  register: {\n    username: '',\n    password: '',\n    passwordConfirm: '',\n  },\n\n  login: {\n    username: '',\n    password: '',\n  },\n  authError: null,\n  authDuplicateError: null,\n  auth: null,\n};\n\nconst authSlice = createSlice({\n  name: 'authForm',\n  initialState: initialAuthFormState,\n  reducers: {\n    changeField: (\n      state,\n      {\n        payload,\n      }: PayloadAction<{\n        form: 'login' | 'register';\n        value: string;\n        name: string;\n      }>\n    ) => {\n      const { form, name, value } = payload;\n      console.log(current(state));\n      state[form][name] = value;\n    },\n    initialForm: (\n      state,\n      { payload }: PayloadAction<{ form: 'login' | 'register' }>\n    ) => {\n      const { form } = payload;\n      if (form === 'login') state[form] = initialAuthFormState[form];\n      else state[form] = initialAuthFormState[form];\n    },\n  },\n  extraReducers: (builder) => {\n    builder\n      .addCase(authRegister.pending, (state, action) => {\n        console.log('pending auth');\n      })\n      .addCase(authRegister.fulfilled, (state, action) => {\n        console.log('fulfilled auth');\n      })\n      .addCase(authRegister.rejected, (state, action) => {\n        console.log('rejected auth');\n        console.log(action);\n      })\n      .addCase(authLogin.pending, (state, action) => {\n        console.log('pending');\n      })\n      .addCase(authLogin.fulfilled, (state, action) => {\n        console.log('fulfilled');\n      })\n      .addCase(authLogin.rejected, (state, action) => {\n        console.log('rejected');\n      });\n  },\n});\n\nexport const { changeField, initialForm } = authSlice.actions;\n\nexport default authSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}